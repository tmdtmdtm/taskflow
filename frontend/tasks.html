<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Taskflow-Tasks</title>
</head>
<body>
    <h1>Your Tasks</h1>
    <div>
        <input type="text" id="title" placeholder="title">
        <input type="text" id="description" placeholder="description">
        <button id="AddBtn">Add Task</button>
    </div>
    <ul id="TaskList"></ul>

    <script>
        const token = localStorage.getItem("token");
        if(!token) {
            window.location.href = "login.html";
        }

        async function loadTasks() {
            const res = await fetch(`http://127.0.0.1:8000/tasks?token=${token}`);
            if(res.ok){
                const tasks = await res.json();
            } else {
                document.getElementById("TaskList").innerText = "list get error";
            }
            

            const list = document.getElementById("TaskList");
            list.innerHTML = "";
            
            tasks.forEach(task => {
                const li = document.createElement("li");
                li.textContent = `${task.title} - ${task.description || ""}`;

                const delBtn = document.createElement("button");
                delBtn.textContent = "delete";
                
                delBtn.onclick = async () => {
                    const res = await fetch(`http://127.0.0.1:8000/tasks/${task.id}?token=${token}`,{
                        method:"DELETE"
                    });
                    loadTasks();
                };

                li.appendChild(delBtn);
                list.appendChild(li);
            });
        };
        loadTasks();

    </script>
</body>
</html>