<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Taskflow-Tasks</title>
</head>
<body>
    <h1>Your Tasks</h1>
    <div>
        <input type="text" id="title" placeholder="title">
        <input type="text" id="description" placeholder="description">
        <button id="AddBtn">Add Task</button>
    </div>
    <ul id="taskList"></ul>

    <script>
        const token = localStorage.getItem("token");
        if (!token) {
            window.location.href = "login.html";
        }

        async function loadTasks() {
            const res = await fetch(`https://taskflow-j1ue.onrender.com/tasks?token=${token}`);
            const tasks = await res.json();

            const list = document.getElementById("taskList");
            list.innerHTML = "";
            
            tasks.forEach(task => {
                const li = document.createElement("li");
                li.innerHTML = `${task.title}-${task.description}`;

                const delBtn = document.createElement("button");
                delBtn.textContent = "delete";
                
                delBtn.onclick = async () => {
                    await fetch(`https://taskflow-j1ue.onrender.com/tasks/${task.id}?token=${token}`,{
                        method:"DELETE"
                    });
                    loadTasks();
                };

                li.appendChild(delBtn);
                list.appendChild(li);
            });
        };

        document.getElementById("AddBtn").onclick = async () => {
            const title = document.getElementById("title").value;
            const description = document.getElementById("description").value;

            await fetch(`https://taskflow-j1ue.onrender.com/tasks?token=${token}`,{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify({title,description})
            });

            loadTasks();
        };

        loadTasks();

    </script>
</body>
</html>